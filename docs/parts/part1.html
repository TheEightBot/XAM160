<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=US-ASCII">
    <title>Exercise 1: Determine your database file path</title>
    <link rel="stylesheet" type="text/css" href="./res/styles/normalize.css">
    <link rel="stylesheet" type="text/css" href="./res/styles/prettify.css" />
    <link rel="stylesheet" type="text/css" href="./res/styles/styles.css">
</head>

<body>
    <!-- Use the same title as the StartHere -->
    <header>XAM160 SQLite and Mobile Data</header>

    <section id="main">
        <h2>Exercise 1: Determine your database file path</h2>
<p>In this exercise, you will create a new Xamarin.Forms application and determine the location to store a database file on each platform. We are going to initially display the full path to where we want to store the file as a <code>Label</code> as shown here:</p>
<figure class="figure">
<img src="./images/ios-final.png" alt="image" />
</figure>
<blockquote class="info-quote">To complete the exercise, you will need <a href="https://www.visualstudio.com/" target="_blank">Visual Studio for Windows or macOS</a> with the <a href="https://visualstudio.microsoft.com/xamarin/" target="_blank">Xamarin development tools</a> installed. You will also need either an emulator/simulator or a device to run the exercise on. Please see the <a href="https://docs.microsoft.com/xamarin/cross-platform/get-started/installation/" target="_blank">setup page</a> if you need help installing the Xamarin development environment.
</blockquote>

<hr>
<h2>Create the solution</h2>
<p>We're going to start by creating a new Xamarin.Forms application using the Portable Class Library template.</p>
<ide name="vs">
<ol>
<li>Create a new Xamarin.Forms application. You'll find the project template under <strong>Visual C#</strong> &gt; <strong>Cross-Platform</strong> &gt; <strong>Cross Platform App (Xamarin.Forms)</strong>.</li>
<li>The app will eventually store information about people you know so name the app <strong>People</strong>.</li>
<li>Click <strong>OK</strong> to get to the next page of the wizard.</li>
<li>
On the <strong>New Cross Platform App</strong> page, verify several settings.
<ol>
<li>Ensure <strong>Blank App</strong> is selected for the template.</li>
<li>Choose <strong>Xamarin.Forms</strong> under <strong>UI Technology</strong>.</li>
<li>Select <strong>.NET Standard</strong> under <strong>Code Sharing Strategy</strong></li>
</ol>
</li>
<li>Click <strong>OK</strong> to create your Xamarin.Forms application.</li>
<li>Make sure the app builds and runs properly&mdash;it will display a &quot;Hello Forms&quot; message.</li>
</ol>
<blockquote class="info-quote">You may need to change the configuration drop-down&mdash;for example, iOS requires &quot;iPhone&quot; or &quot;iPhoneSimulator&quot;, and Windows projects typically must be &quot;x86&quot; or &quot;x64&quot;.
</blockquote>
</ide>
<ide name="xs">
<ol>
<li>Create a new Xamarin.Forms application. You'll find the the project template under <strong>Multiplatform</strong> &gt; <strong>App</strong> &gt; <strong>Blank Forms App</strong>. Make sure C# is selected in the drop-down and click the <strong>Next</strong> button to start the project wizard.</li>
<li>The app will eventually store information about people you know so name the app <strong>People</strong>.</li>
<li>Ensure the <strong>Use Portable Class Library</strong> radio button is selected and make sure the option to use XAML is selected</li>
<li>Click <strong>Next</strong> to move to the next screen.</li>
<li>On the <strong>Configure your new Forms App</strong> screen, leave the default settings and click <strong>Create</strong> to create the project.</li>
</ol>
<p>Visual Studio for Mac currently generates slightly different code from the template. In particular, it will name the XAML page and code-behind <strong>PeoplePage.xaml</strong>. Perform the following steps to make it unify it with what is generated by Visual Studio for Windows (so you can follow the rest of the lab instructions).</p>
<ol>
<li>Rename <strong>PeoplePage</strong> to <strong>MainPage</strong>. Open the code-behind file, select the class name and use <kbd>âŒ˜</kbd>+<kbd>R</kbd> or right-click on the type name and use <strong>Refactor</strong> &gt; <strong>Rename</strong>. Make sure the checkbox to rename the file is selected (if you forget, it's ok&mdash;just rename both the .xaml and .xaml.cs file in the solution explorer window too).</li>
<li>Make sure the app builds and runs properly, displaying a welcome message.</li>
</ol>
</ide>

<hr>
<h2>Add platform-specific code</h2>
<p>We'll add a new class to each platform specific project that will return a reasonable path that can be used to store a database file.</p>
<ol>
<li>Add a new class named <code>FileAccessHelper</code> to each of the platform-specific projects. Ensure this class in each project is <code>public</code>.</li>
<li>Add a <code>static</code> method named <code>GetLocalFilePath</code> that accepts a <code>string</code> parameter named <code>filename</code> and returns a <code>string</code>. Make sure you add this method to each platform.</li>
</ol>
<blockquote>
<strong>Note</strong> you can create the file in one project and then <em>copy</em> it into the other platform-specific projects to save some time and typing - just make sure to change the namespace and <code>using</code> statements to suite each platform.
</blockquote>
<pre class="prettyprint-collapse"><code>public class FileAccessHelper
{
    public static string GetLocalFilePath(string filename)
    {

    }
}
</code></pre>

<ol start="3">
<li>
Implement each of the <code>GetLocalFilePath</code> methods. The input parameter is the desired filename for the database. Return the combined folder location and database file name.
<ul>
<li>On <strong>Android</strong>, retrieve the <code>Personal</code> folder using the <code>System.Environment.GetFolderPath</code> method.</li>
</ul>
</li>
</ol>
<pre class="prettyprint-collapse"><code>string path = System.Environment.GetFolderPath(
    System.Environment.SpecialFolder.Personal);
return System.IO.Path.Combine(path, filename);
</code></pre>

<ol start="4">
<li>On <strong>iOS</strong>, store the database in the <strong>Library</strong> folder. Again, start by retrieving the <code>Personal</code> folder using <code>System.Environment.GetFolderPath</code>. Then go up one folder level and navigate to <strong>Library</strong>. Hint: use <code>System.IO.Path.Combine</code>.</li>
</ol>
<pre class="prettyprint-collapse"><code>string docFolder = Environment.GetFolderPath(Environment.SpecialFolder.Personal);
string libFolder = System.IO.Path.Combine(docFolder, &quot;..&quot;, &quot;Library&quot;);

if (!System.IO.Directory.Exists(libFolder)) {
    System.IO.Directory.CreateDirectory(libFolder);
}

return System.IO.Path.Combine(libFolder, filename);
</code></pre>

<ol start="5">
<li>For any of the supported <strong>Windows</strong> platforms, the folder location can be found using <code>Windows.Storage.ApplicationData.Current.LocalFolder.Path</code>.</li>
</ol>
<pre class="prettyprint-collapse"><code>string path = global::Windows.Storage.ApplicationData.Current.LocalFolder.Path;
return System.IO.Path.Combine(path, filename);
</code></pre>


<hr>
<h2>Display the path</h2>
<p>We'll show the fully qualified path using the <code>Label</code> created by default with the Xamarin.Forms new project template. We need to make a few small changes to make this happen.</p>
<ol>
<li>
First, let's make the <code>Label</code> accessible to our code behind.
<ul>
<li>Open the <code>MainPage.xaml</code> file in the PCL project.</li>
<li>Locate the single <code>Label</code> child.</li>
<li>Add an <code>x:Name</code> attribute and name the label <strong>textLabel</strong>.</li>
</ul>
</li>
<li>
Next, open the C# <code>MainPage</code> code-behind class in the PCL project.
<ul>
<li>Add a new public property named <strong>Text</strong> and have the get/set operators retrieve and change the value of the <code>textLabel.Text</code> visual property.</li>
</ul>
</li>
</ol>
<pre class="prettyprint-collapse"><code>public partial class MainPage : ContentPage
{
    <mark>public string Text</mark>
    <mark>{</mark>
    <mark>    get { return textLabel.Text; }</mark>
    <mark>    set { textLabel.Text = value; }</mark>
    <mark>}</mark>

    public MainPage()
    {
        InitializeComponent();
    }
}
</code></pre>

<ol start="3">
<li>
Open the C# <code>Application</code> class in the PCL project.
<ul>
<li>Change the <code>App</code> constructor to accept a <code>string</code> parameter named <strong>displayText</strong>.</li>
<li>After the <code>MainPage</code> is created, set the <code>Text</code> property to the value passed into the constructor.</li>
</ul>
</li>
</ol>
<pre class="prettyprint-collapse"><code>public App(<mark>string displayText</mark>)
{
    InitializeComponent();

    MainPage = new People.MainPage()
    <mark>{</mark>
    <mark>    Text = displayText</mark>
    <mark>};</mark>
}
</code></pre>


<hr>
<h2>Pass platform-specific data to shared code</h2>
<p>Our final step is to pass the database path from the platform-specific projects to the PCL so it can be displayed.</p>
<ol>
<li>In each platform-specific project, find the code that instantiates the <strong>App</strong> class. This will be different on each platform.</li>
<li>Call the static <code>FileAccessHelper.GetLocalFilePath</code> method that you created earlier and pass in <strong>people.db3</strong> as the file name parameter.</li>
<li>Pass the returned fully qualified filename into the <strong>App</strong>'s constructor.</li>
</ol>
<p>On iOS, this will be done in the <strong>AppDelegate</strong>:</p>
<pre class="prettyprint-collapse"><code>public partial class AppDelegate : global::Xamarin.Forms.Platform.iOS.FormsApplicationDelegate
{
   ...
   public override bool FinishedLaunching(UIApplication app, NSDictionary options)
   {
      global::Xamarin.Forms.Forms.Init();
      string dbPath = FileAccessHelper.GetLocalFilePath(&quot;people.db3&quot;);
      LoadApplication(new App(dbPath));
      return base.FinishedLaunching(app, options);
   }
}
</code></pre>

<p>On Android, the <strong>App</strong> class is instantiated in the <strong>MainActivity</strong>:</p>
<pre class="prettyprint-collapse"><code>public class MainActivity : global::Xamarin.Forms.Platform.Android.FormsApplicationActivity
{
   protected override void OnCreate(Bundle bundle)
   {
      ...
      base.OnCreate(bundle);
      global::Xamarin.Forms.Forms.Init(this, bundle);
      string dbPath = FileAccessHelper.GetLocalFilePath(&quot;people.db3&quot;);
      LoadApplication(new App(dbPath));
   }
}
</code></pre>

<p>On Windows, the <strong>App</strong> class is instantiated in the code-behind for <strong>MainPage</strong>:</p>
<pre class="prettyprint-collapse"><code>public partial class MainPage : global::Xamarin.Forms.Platform.WinPhone.FormsApplicationPage
{
   public MainPage()
   {
       this.InitializeComponent();
       string dbPath = FileAccessHelper.GetLocalFilePath(&quot;people.db3&quot;);
       LoadApplication(new People.App(dbPath));
   }
}
</code></pre>


<hr>
<h2>Run the application</h2>
<p>Run the application on each platforms. They should all display the fully qualified database file path.</p>
<p>Remember to select a build configuration for each platform. For example, Windows UWP requires either <code>x86</code> or <code>x64</code> and iOS requires either <code>iPhone</code> or <code>iPhoneSimulator</code>.</p>
<figure class="figure">
<img src="./images/android-final.png" alt="Android" />
</figure>
<div>
</div>
<figure class="figure">
<img src="./images/uwp-final.png" alt="Windows UWP" />
</figure>

<hr>
<h2>Exercise summary</h2>
<p>In this exercise, you retrieved the platform-specific database paths for each platform and displayed the result with the main page of the app. In a later exercise, you will extend this solution to connect to SQLite.</p>
<p>You can view the completed solution in the <strong>Exercise 1 &gt; Completed</strong> folder of your copy of the cloned or downloaded <a href="https://github.com/TheEightBot/XAM160/">course materials</a>.</p>


        <div class="align-right">
            <a href="../StartHere.html">Go Back</a>
        </div>

    </section>

    <script src="./res/js/jquery.min.js"></script>
    <script src="./res/js/jquery.imagemapster.min.js"></script>
    <script src="./res/js/imagemap.js"></script>
    <script src="./res/js/prettify.js"></script>
    <script src="./res/js/script.js"></script>

    <footer>Copyright (C) 2018 Xamarin Inc., Microsoft. All rights reserved.<br><a target="_blank" href="http://university.xamarin.com">Visit Xamarin University for more classes and content</a></footer>

</body>
</html>